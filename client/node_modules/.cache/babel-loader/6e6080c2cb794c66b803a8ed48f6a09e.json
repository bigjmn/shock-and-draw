{"ast":null,"code":"import _slicedToArray from\"/Users/jessenicholas/shock-draw-final/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import Controls from\"../Controls/Controls\";import socket from'../../context/socket.js';import classes from'./Canvas.module.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Canvas=function Canvas(_ref){var word=_ref.word;var canvasRef=React.useRef(null);var parentRef=React.useRef(null);var _useState=useState({}),_useState2=_slicedToArray(_useState,2),ctx=_useState2[0],setCtx=_useState2[1];var _useState3=useState({x:0,y:0}),_useState4=_slicedToArray(_useState3,2),canvasOffset=_useState4[0],setCanvasOffset=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),drawing=_useState6[0],setDrawing=_useState6[1];var _useState7=useState({x:0,y:0}),_useState8=_slicedToArray(_useState7,2),position=_useState8[0],setPosition=_useState8[1];var _useState9=useState(\"#000000\"),_useState10=_slicedToArray(_useState9,2),color=_useState10[0],setColor=_useState10[1];var _useState11=useState(5),_useState12=_slicedToArray(_useState11,2),thickness=_useState12[0],setThickness=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),activeTake=_useState14[0],setActiveTake=_useState14[1];var _useState15=useState(\"default\"),_useState16=_slicedToArray(_useState15,2),cursorstyle=_useState16[0],setCursorstyle=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),frozen=_useState18[0],setFrozen=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),fading=_useState20[0],setFading=_useState20[1];// const [drawPack, setDrawPack] = useState([])\n// const addPack = (payload) => {\n//   setDrawPack((oldPack) =>  [...oldPack, payload])\n//   console.log(drawPack)\n// }\nfunction throttled(delay,fn){var lastCall=0;return function(){var now=new Date().getTime();if(now-lastCall<delay){return;}lastCall=now;return fn.apply(void 0,arguments);};}useEffect(function(){var canv=canvasRef.current;canv.width=parentRef.current.offsetWidth;canv.height=parentRef.current.offsetHeight;var canvCtx=canv.getContext(\"2d\");canvCtx.lineJoin=\"round\";canvCtx.lineCap=\"round\";setCtx(canvCtx);var offset=canv.getBoundingClientRect();setCanvasOffset({x:parseInt(offset.left),y:parseInt(offset.top)});},[ctx]);var correctSign=function correctSign(){ctx.fillStyle='black';ctx.fillRect(90,90,320,220);ctx.fillStyle='white';ctx.fillRect(100,100,300,200);ctx.fillStyle='black';ctx.font='bold 42px serif';ctx.textAlign='center';ctx.fillText('CORRECT!',250,140);ctx.fillStyle='green';ctx.font='bold 42px serif';ctx.fillText(word+' ✔',250,260);setTimeout(function(){setFrozen(false);socket.emit('getNext');},2000);};var passSign=function passSign(){ctx.fillStyle='black';ctx.fillRect(90,90,320,220);ctx.fillStyle='white';ctx.fillRect(100,100,300,200);ctx.fillStyle='black';ctx.font='bold 42px serif';ctx.textAlign='center';ctx.fillText('PASS',250,140);ctx.font='bold 42px serif';ctx.fillText(word+' ❌',250,260);setTimeout(function(){setFrozen(false);socket.emit('getNext');socket.emit('hitme');},2000);};useEffect(function(){socket.on('takeClear',function(){ctx.clearRect(0,0,500,500);});socket.on('hidemouse',function(){setCursorstyle('none');});socket.on('hidemouseclear',function(){setCursorstyle('default');});socket.on('canfade',function(){setFading(true);});socket.on('canfadeclear',function(){setFading(false);});socket.on('correct',function(){setDrawing(false);setFrozen(true);correctSign();});socket.on('passmessage',function(){setDrawing(false);setFrozen(true);passSign();});return function(){socket.off('takeClear');socket.off('hidemouse');socket.off('hidemouseclear');socket.off('correct');socket.off('passmessage');};});function handleMouseDown(e){if(frozen){return;}setDrawing(true);setPosition({x:parseInt(e.nativeEvent.offsetX),y:parseInt(e.nativeEvent.offsetY)});console.log(position);ctx.fillStyle=color;ctx.beginPath();ctx.arc(position.x,position.y,thickness/2,0,2*Math.PI);ctx.fill();ctx.closePath();var payload={centerx:position.x,centery:position.y,color:color,thickness:thickness};socket.emit('sendDot',{payload:payload});}function handleMouseUp(){setDrawing(false);}function handleMouseOut(){setDrawing(false);}var fadeCanvas=function fadeCanvas(){ctx.strokeStyle=rgb(255,255,255,0.1);ctx.fillRect(0,0,500,500);};var handleMouseMove=function handleMouseMove(e){var mousex=e.nativeEvent.offsetX;var mousey=e.nativeEvent.offsetY;if(drawing){ctx.strokeStyle=color;ctx.lineWidth=thickness;ctx.beginPath();ctx.moveTo(position.x,position.y);ctx.lineTo(mousex,mousey);ctx.stroke();var payload={oldx:position.x,oldy:position.y,newx:mousex,newy:mousey,color:color,thickness:thickness};socket.emit('sendPack',{payload:payload});}setPosition({x:mousex,y:mousey});};var throttledhandleMouseMove=throttled(50,handleMouseMove);function handleColor(color){setColor(color);}var handleSize=function handleSize(size){setThickness(size);};var handleTaker=function handleTaker(){setActiveTake(!activeTake);console.log(activeTake);};return/*#__PURE__*/_jsxs(\"div\",{className:classes.boardContainer,ref:parentRef,children:[/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,onMouseDown:handleMouseDown,onMouseUp:handleMouseUp,onMouseMove:throttledhandleMouseMove,onMouseOut:handleMouseOut,height:\"500\",width:\"500\",style:{border:\"1px solid\",cursor:cursorstyle}}),/*#__PURE__*/_jsx(\"div\",{className:classes.controlContainer,children:/*#__PURE__*/_jsx(Controls,{handleColor:handleColor,handleSize:handleSize,activeTake:activeTake})}),fading&&/*#__PURE__*/_jsx(FadeControl,{fadeCanvas:fadeCanvas})]});};export default Canvas;","map":{"version":3,"sources":["/Users/jessenicholas/shock-draw-final/client/src/components/Canvas/Canvas.js"],"names":["React","useState","useEffect","Controls","socket","classes","Canvas","word","canvasRef","useRef","parentRef","ctx","setCtx","x","y","canvasOffset","setCanvasOffset","drawing","setDrawing","position","setPosition","color","setColor","thickness","setThickness","activeTake","setActiveTake","cursorstyle","setCursorstyle","frozen","setFrozen","fading","setFading","throttled","delay","fn","lastCall","now","Date","getTime","canv","current","width","offsetWidth","height","offsetHeight","canvCtx","getContext","lineJoin","lineCap","offset","getBoundingClientRect","parseInt","left","top","correctSign","fillStyle","fillRect","font","textAlign","fillText","setTimeout","emit","passSign","on","clearRect","off","handleMouseDown","e","nativeEvent","offsetX","offsetY","console","log","beginPath","arc","Math","PI","fill","closePath","payload","centerx","centery","handleMouseUp","handleMouseOut","fadeCanvas","strokeStyle","rgb","handleMouseMove","mousex","mousey","lineWidth","moveTo","lineTo","stroke","oldx","oldy","newx","newy","throttledhandleMouseMove","handleColor","handleSize","size","handleTaker","boardContainer","border","cursor","controlContainer"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport Controls from \"../Controls/Controls\";\nimport socket from '../../context/socket.js'\n\nimport classes from './Canvas.module.css'\n\nconst Canvas = ({word}) => {\n  const canvasRef = React.useRef(null);\n  const parentRef = React.useRef(null);\n  const [ctx, setCtx] = useState({});\n  const [canvasOffset, setCanvasOffset] = useState({ x: 0, y: 0 });\n  const [drawing, setDrawing] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [color, setColor] = useState(\"#000000\");\n  const [thickness, setThickness] = useState(5)\n  const [activeTake, setActiveTake] = useState(false)\n\n  const [cursorstyle, setCursorstyle] = useState(\"default\")\n  const [frozen, setFrozen] = useState(false)\n  const [fading, setFading] = useState(false)\n\n\n  // const [drawPack, setDrawPack] = useState([])\n\n\n\n\n  // const addPack = (payload) => {\n  //   setDrawPack((oldPack) =>  [...oldPack, payload])\n  //   console.log(drawPack)\n  // }\n  function throttled(delay, fn) {\n  let lastCall = 0;\n  return function (...args) {\n    const now = (new Date).getTime();\n    if (now - lastCall < delay) {\n      return;\n    }\n    lastCall = now;\n    return fn(...args);\n  }\n}\n\n\n\n\n\n\n\n\n\n\n  useEffect(() => {\n    let canv = canvasRef.current;\n    canv.width = parentRef.current.offsetWidth;\n    canv.height = parentRef.current.offsetHeight;\n\n    let canvCtx = canv.getContext(\"2d\");\n    canvCtx.lineJoin = \"round\";\n    canvCtx.lineCap = \"round\";\n\n    setCtx(canvCtx);\n\n    let offset = canv.getBoundingClientRect();\n    setCanvasOffset({ x: parseInt(offset.left), y: parseInt(offset.top) });\n  }, [ctx]);\n\n  const correctSign = () =>{\n    ctx.fillStyle = 'black'\n    ctx.fillRect(90, 90, 320, 220)\n    ctx.fillStyle = 'white'\n    ctx.fillRect(100,100,300,200)\n    ctx.fillStyle = 'black'\n    ctx.font = 'bold 42px serif'\n    ctx.textAlign = 'center'\n      ctx.fillText('CORRECT!', 250, 140)\n    ctx.fillStyle = 'green'\n    ctx.font = 'bold 42px serif'\n    ctx.fillText(word+' ✔', 250, 260)\n    setTimeout(() => {\n      setFrozen(false)\n      socket.emit('getNext')\n    }, 2000)\n  }\n\n  const passSign = () =>{\n    ctx.fillStyle = 'black'\n    ctx.fillRect(90, 90, 320, 220)\n    ctx.fillStyle = 'white'\n    ctx.fillRect(100,100,300,200)\n    ctx.fillStyle = 'black'\n    ctx.font = 'bold 42px serif'\n    ctx.textAlign = 'center'\n    ctx.fillText('PASS', 250, 140)\n    ctx.font = 'bold 42px serif'\n    ctx.fillText(word+' ❌', 250, 260)\n    setTimeout(() => {\n      setFrozen(false)\n      socket.emit('getNext')\n      socket.emit('hitme')\n    }, 2000)\n  }\n\n  useEffect(() => {\n    socket.on('takeClear', () => {\n      ctx.clearRect(0,0,500,500)\n    })\n    socket.on('hidemouse', () => {\n      setCursorstyle('none')\n    })\n    socket.on('hidemouseclear', () => {\n      setCursorstyle('default')\n    })\n    socket.on('canfade', () => {\n      setFading(true)\n    })\n    socket.on('canfadeclear', () => {\n      setFading(false)\n    })\n    socket.on('correct', () => {\n      setDrawing(false)\n      setFrozen(true)\n      correctSign()\n    })\n    socket.on('passmessage', () => {\n      setDrawing(false)\n      setFrozen(true)\n      passSign()\n    })\n\n    return () => {\n      socket.off('takeClear')\n      socket.off('hidemouse')\n      socket.off('hidemouseclear')\n      socket.off('correct')\n      socket.off('passmessage')\n\n    }\n  })\n\n\n\n  function handleMouseDown(e) {\n    if (frozen){\n      return\n    }\n    setDrawing(true);\n    setPosition({\n      x: parseInt(e.nativeEvent.offsetX),\n      y: parseInt(e.nativeEvent.offsetY),\n    });\n    console.log(position)\n    ctx.fillStyle = color\n\n    ctx.beginPath()\n    ctx.arc(position.x, position.y, thickness/2, 0, 2*Math.PI)\n    ctx.fill()\n    ctx.closePath()\n    let payload = {\n      centerx: position.x,\n      centery: position.y,\n      color: color,\n      thickness: thickness\n\n    }\n    socket.emit('sendDot', {payload:payload})\n  }\n  function handleMouseUp() {\n    setDrawing(false);\n  }\n  function handleMouseOut() {\n    setDrawing(false);\n  }\n\n  const fadeCanvas = () => {\n    ctx.strokeStyle = rgb(255,255,255,0.1)\n    ctx.fillRect(0,0,500,500)\n  }\n\n  const handleMouseMove = (e) => {\n    let mousex = e.nativeEvent.offsetX;\n    let mousey = e.nativeEvent.offsetY;\n    if (drawing) {\n      ctx.strokeStyle = color;\n      ctx.lineWidth = thickness;\n      ctx.beginPath();\n      ctx.moveTo(position.x, position.y);\n      ctx.lineTo(mousex, mousey);\n      ctx.stroke();\n      var payload = {\n        oldx: position.x,\n        oldy: position.y,\n        newx: mousex,\n        newy: mousey,\n        color: color,\n        thickness: thickness\n      }\n\n      socket.emit('sendPack', {payload:payload})\n\n    }\n    setPosition({ x: mousex, y: mousey });\n  }\n\n  const throttledhandleMouseMove = throttled(50, handleMouseMove)\n\n  function handleColor(color) {\n    setColor(color);\n  }\n  const handleSize = (size) => {\n    setThickness(size)\n  }\n  const handleTaker = () => {\n\n    setActiveTake(!activeTake)\n    console.log(activeTake)\n  }\n\n  return (\n\n\n\n    <div className={classes.boardContainer} ref={parentRef}>\n\n\n\n\n\n      <canvas\n        ref={canvasRef}\n        onMouseDown={handleMouseDown}\n        onMouseUp={handleMouseUp}\n        onMouseMove={throttledhandleMouseMove}\n        onMouseOut={handleMouseOut}\n        height=\"500\" width=\"500\"\n\n\n        style={{border:\"1px solid\", cursor: cursorstyle }}\n\n      />\n      <div className={classes.controlContainer}>\n        <Controls handleColor={handleColor} handleSize={handleSize} activeTake={activeTake}/>\n\n      </div>\n      {fading && <FadeControl fadeCanvas={fadeCanvas}/>}\n\n\n    </div>\n\n  );\n\n}\n\nexport default Canvas;\n"]},"metadata":{},"sourceType":"module"}